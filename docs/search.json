[
  {
    "objectID": "qmd/01_sample_selection.html",
    "href": "qmd/01_sample_selection.html",
    "title": "1Â  Sample selection",
    "section": "",
    "text": "toggle code\ndata <- readxl::read_xlsx(here(\"../import_anneke/data/processed/Unique_filtered_dataset_2022.xlsx\")) |> \n  dplyr::select(PupTissueID, uniqueID_pup, PupBirthyear, status, PupSex, pup_SNPed, Beach) |> \n  filter(Beach == \"SSB\",\n         PupSex == \"F\",\n         !is.na(PupBirthyear))\n\n# data |> \n#   group_by(uniqueID_pup) |> \n#   count() |> arrange(-n) \n#  # group_by(n) |>\n#  # count()\n\ndata |> \n  filter(!duplicated(uniqueID_pup)) |> \n  group_by(PupBirthyear, status, pup_SNPed) |> \n  count() |> \n  ggplot() +\n  geom_hline(yintercept = 2, linetype = 3 ) +\n  geom_bar(aes(x = PupBirthyear, y = n, fill = status),\n           stat = \"identity\",\n           position = position_dodge2(width = 0.9, preserve = \"single\"),\n           color = \"transparent\") +\n  facet_grid(pup_SNPed ~ .,\n             labeller = label_both,\n             switch = \"y\") +\n  theme(legend.position = \"bottom\",\n        axis.line.x = element_line(size = .2),\n        legend.key.height = unit(2, \"pt\"))\n\n\n\n\n\nFor each year, two samples are randomly chosen per recruitment status. Try to use only SNPed samples, if necessary fill up to two samples where possible (if only one sample is available, pick this one).\n\n\ntoggle code\ndata_selction <- data |> \n  filter(!duplicated(uniqueID_pup),\n         PupSex == \"F\",\n         status %in% c(\"Recruited\", \"NonRecruited\") ) |> \n  group_by(PupBirthyear, status, pup_SNPed) |> \n  mutate(selector = sample(1:n())) |> \n  filter(selector <= 2) |>            # slice_sample(n = 2) cant subset for years with only one sample \n  ungroup() |> \n  arrange(PupBirthyear, status, pup_SNPed) |> \n  group_by(PupBirthyear, status) |> \n  mutate(priority = row_number()) |>\n  ungroup() |> \n  filter(priority <= 2)                # if possible, use SNPed samples, fill up if necessary\n\n\nLooking up available alternative tissue samples for the selected individuals.\n\n\ntoggle code\n# Collect alternative tissue IDs\nuniqueIDs <- openxlsx::read.xlsx(here(\"../import_anneke/data/processed/all_msat_genotypes_uniqueID.xlsx\")) %>%\n  dplyr::select(dummyID, PlateNumber, uniqueID) |> \n  filter(!dummyID %in% c(\"AGP08134\", \"AGP18084\")) |>\n  # mutate(uniqueID = if_else(dummyID %in% c(\"AGP08134\", \"AGP18084\"),  NA_character_ , uniqueID),   # annekes approach, keeps NA, NA row\n  #        dummyID = if_else(dummyID %in% c(\"AGP08134\", \"AGP18084\"),  NA_character_ , dummyID)) |>  # ...134/139 match, genetic mother mismatch for ...84\n  dplyr::select(-PlateNumber) |> \n  unique()\n\n# Merge IDs with list of remaining individuals\ntissue_options <- data_selction |> \n  left_join(uniqueIDs, by = c(\"uniqueID_pup\" = \"uniqueID\")) |> \n  dplyr::rename(`AltTissueID`= dummyID )\n\n# Check duplicates (ie alternative IDs)\n# tissue_options %>%\n#   filter(uniqueID_pup %in% unique(.[[\"uniqueID_pup\"]][duplicated(.[[\"uniqueID_pup\"]])]))\n\nall_duplicated <- \\(x){\n  duplicated(x) | duplicated(x, fromLast = TRUE)\n}\n\n\ntissue_options %>%\n  mutate(AltTissueID = ifelse(AltTissueID==PupTissueID, NA, AltTissueID)) %>%\n  group_by(uniqueID_pup) %>%\n  arrange(AltTissueID) %>%\n  mutate(numbering = paste0(\"AltTissueID_\", row_number())) %>%\n  pivot_wider(id_cols = PupTissueID:Beach,\n              names_from = \"numbering\",\n              values_from = \"AltTissueID\") |> \n  dplyr::select(uniqueID_pup:Beach, everything()) |> \n  arrange(PupBirthyear)  |> \n  datatable(extensions = 'Buttons',\n            options = list(dom = 'Blfrtip',\n                           buttons = c('copy', 'csv'),\n                           pageLength = 10), \n            rownames = FALSE, \n            class = 'cell-border stripe') |>  \n  formatStyle(columns = 1:10,\n              fontSize = '75%',\n              lineHeight = \"1em\")\n\n\n\n\n\n\n\nSummarize the sample selection by strata (year, recruitment success, SNP availability).\n\n\ntoggle code\nselction_summary <- data_selction |> \n  group_by(PupBirthyear, status, pup_SNPed) |> \n  count() \n\nggplot() +\n  geom_bar(data = selction_summary |> \n             filter(status != \"Recruited\"),\n           aes(x = PupBirthyear, y = n, fill = status),\n           stat = \"identity\",\n           color = \"transparent\") +\n  geom_bar(data = selction_summary |> \n             filter(status == \"Recruited\"),\n           aes(x = PupBirthyear, y = -n, fill = status),\n           stat = \"identity\",\n           color = \"transparent\") +\n  geom_text(data = selction_summary |>\n              group_by(status, pup_SNPed) |> \n              summarise(n = sum(n)) |> \n              ungroup() |> \n              mutate(y = 2 * (1.5 - as.numeric(factor(status)))) ,\n            aes(x = 1974, y = y, label = n, color = status)) +\n  geom_hline(yintercept = 0 ) +\n  facet_grid(pup_SNPed ~ ., \n             labeller = label_both,\n             switch = \"y\") +\n  theme(legend.position = \"bottom\",\n        legend.key.height = unit(2, \"pt\"),\n        panel.grid.major.x = element_line(color = clr_light,\n                                          size = .3))"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Antarctic Fur Seal Genetic Load",
    "section": "",
    "text": "Preface"
  }
]